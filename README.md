# Unofficial VK Play Live API

This library is unofficial API (for https://vkplay.live/) and uses undocumented features, so there is no guarantee that it will be fully functional after some time.

Everything here is reverse engineered.

- If I can do something in browser, then this MUST be available through an API
- If I can do something anonymously (without account) then I don't need some_sort of API key or another type of access

### Usage

```bash
git clone https://github.com/Something-Went-Wrong-ORG/unofficial-vk-play-live-api.git YOURFOLDERNAME
cd YOURFOLDERNAME

# Run npm install. That's all!
npm install
```

**Start coding!** `package.json` and entry files are already set up for you, so don't worry about linking to your main file, typings, etc. Just keep those files with the same name.

### Features

- Get Last Messages from Stream (see [requesting](#)/[converting](#))
- Get Messages using WebSockets (TBD, [right now authorisation not working properly here](#))

### Importing library

You can import the generated bundle to use the whole library generated by this starter:

```javascript
import VKPLAPI from 'unofficial-vk-play-live-api';
```

Additionally, you can import the transpiled modules from `dist/lib` in case you have a modular library:

```javascript
import something from 'unofficial-vk-play-live-api/dist/lib/something';
```

### NPM scripts

- `npm t`: Run test suite
- `npm start`: Run `npm run build` in watch mode
- `npm run test:watch`: Run test suite in [interactive watch mode](http://facebook.github.io/jest/docs/cli.html#watch)
- `npm run test:prod`: Run linting and generate coverage
- `npm run build`: Generate bundles and typings, create docs
- `npm run lint`: Lints code
- `npm run commit`: Commit using conventional commit style ([husky](https://github.com/typicode/husky) will tell you to use it if you haven't :wink:)

### Examples

#### Get Last Messages from Stream

```js
// Import API
const VKPAPI = require('unofficial-vk-play-live-api');

try {
  // Create instance of Stream Manager
  const streamManager = VKPAPI.GetStreamManager('<channel_id>');
  // Get last messages from stream chat
  const messages = await streamManager.GetLastMessages(100);
} catch (error) {
  // Handle errors
  console.error(error);
}
```

#### Convert messages for your system

```js
// Import API
const VKPAPI = require('unofficial-vk-play-live-api');

try {
  // Create instance of Stream Manager
  const streamManager = VKPAPI.GetStreamManager('<channel_id>');
  // Get last messages from stream chat
  const messages = await streamManager.GetLastMessages(100);

  // Convert messages
  const result = messages.data.map((message) => {
    const name = message.author.displayName;
    const time = message.createdAt * 1000;

    return {
      time,
      // Messages comes from VK Play Live comes as parts you can
      // convert it to something that can be more useful for your app
      message: message.data
        .map((messagePart) => {
          switch (messagePart.type) {
            case 'text':
              return messagePart.content[0];
            case 'smile':
              return `<img src="${messagePart.smallUrl}" />`;
            case 'mention':
              return `<strong>@${messagePart.displayName}</strong>`;
          }
        })
        .join(''),
      name,
      id: `${name}-${time}`
    };
  });
} catch (error) {
  console.error(error);
}
```
